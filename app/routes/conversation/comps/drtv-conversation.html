<section class="body-group recipients">
    <label>{{'CONVERSATION.PLACEHOLDER.RECIPIENTS'|cmTranslate}}</label>
    <div class="recipients-list">
        <div class="scroller">
            <div 
                ng-click    = "goto('conversation/'+(conversation.id||'new')+'/recipients')" 
                ng-if       = "conversation.recipients.length == 1" 
                class       = "add-new-recipients">
                <cm-avatar cm-view="unknown"></cm-avatar>
                {{'CONVERSATION.PLACEHOLDER.ADD_RECIPIENTS' | cmTranslate}}
            </div>
            <cm-avatar cm-data="recipient" cm-with-name="true" cm-view="hide-owner" ng-repeat="recipient in conversation.recipients"></cm-avatar>
        </div>
        <cm-add-button 
            cm-icon =   "add-recipient" 
            ng-click=   "goto('conversation/'+(conversation.id||'new')+'/recipients')" 
            cm-user-rights
        ></cm-add-button>
    </div>
</section>

<div class="body-group subject">
    <div ng-if="!conversation.state.is('new') && conversation.subject" data-qa="text-subject" ng-bind-html="conversation.subject|cmParse"></div>
    <div class="cm-form-group body-group label-with-checkbox" ng-if = "conversation.state.is('new')">
        <label class="w20">{{'CONVERSATION.PLACEHOLDER.SUBJECT' | cmTranslate}}</label>
        <div class="cm-form-control with-inputter w80" style="background-color:#fff">
            <input data-qa="input-subject" style="background-color:#fff" type="text" ng-model="conversation.subject" placeholder="{{'CONVERSATION.PLACEHOLDER.NO_SUBJECT'|cmTranslate}}" cm-adaptive-change  cm-ios-focus="{fixedElements:'cm-header, cm-conversation-controls', scrollTop:true}" />
        </div>
    </div>
</div>

<div id="conversation-top"></div>

<div ng-repeat="message in conversation.messages | orderBy:'created':false " cm-scroll-to="#conversation-bottom" cm-last-message>
    <cm-date-seperator ng-if="(compareDate(message.created,conversation.messages[$index - 1].created))">{{message.created | date:'dd.MM.yyyy'}}</cm-date-seperator>
    <cm-message cm-data="message" cm-data-conversation="conversation"></cm-message>
</div>

<div id="conversation-bottom"></div>

<div class="answer clearfix" id="files-droparea">
    <div class="wrap">
        <cm-files ng-model="files" data-qa="attachments-btn">
            <i class="fa cm-attachment"></i>
            <div cm-user-rights>
                <cm-file-choose cm-droparea="files-droparea"></cm-file-choose>
                <cm-files-preview></cm-files-preview>
            </div>
            <div class="webreader-uploading" cm-user-rights="showForGuest" ng-click="openFastRegister()" data-qa="btn-fast-registration"></div>
        </cm-files>

        <div class="message" data-qa="answer-ctn">
            <textarea data-qa="input-answer" cm-resize-textarea cm-max-rows="8" ng-model="my_message_text" id="emoji-textarea" cm-ios-focus="{fixedElements:'cm-header, cm-conversation-controls',handler:'.post-wrap'}"></textarea>
            <cm-emoji-handler></cm-emoji-handler>
            <div class="inputter"></div>
        </div>

        <div class="post-wrap" data-qa="btn-send-answer" ng-click="send()">
            <i class="fa cm-post with-cursor {{conversation.lockStatus.class}}-wrap" ng-class="{'cm-post-idle':isSending, 'cm-post-attention':isSendingAbort}"></i>
        </div>
    </div>
    <cm-emoji-list ng-model="my_message_text" cm-textarea="emoji-textarea"></cm-emoji-list>
</div>