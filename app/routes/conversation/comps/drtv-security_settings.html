<cm-header cm-rubber-space ng-show="!isPurl">
    <cm-back cm-weight="1" back-to="conversation/{{conversationId}}"></cm-back>
    <cm-identity cm-weight="4"></cm-identity>
    <cm-security-indicator
        cm-weight       = "2"
        cm-data         = "conversation.securityAspects"
        ng-click        = "goto('conversation/'+conversationId+'/security-settings')"
    ></cm-security-indicator>
    <cm-menu cm-weight="1"></cm-menu>
</cm-header>

<cm-header cm-rubber-space ng-show="isPurl">
    <cm-back cm-weight="1" back-to="purl/{{purlId}}"></cm-back>
    <div cm-weight="1"></div>
    <cm-logo cm-weight="4"></cm-logo>
    <cm-security-indicator
        cm-weight       = "2"
        cm-data         = "conversation.securityAspects"
        cm-leading-icon = "cm-lock"
        ng-click        = "goto('purl/'+purlId+'/security-settings')"
    ></cm-security-indicator>
</cm-header>

<section class="body-group no-border">
    <cm-security-aspect ng-repeat="aspect in conversation.securityAspects.getPositiveAspects()" cm-data="aspect"></cm-security-aspect>
    <cm-security-aspect ng-repeat="aspect in conversation.securityAspects.getNegativeAspects()" cm-data="aspect"></cm-security-aspect>
</section>

<section class="body-group no-padding">
    <div class="label-with-checkbox">
        <label>{{'CONVERSATION.PLACEHOLDER.ENCRYPTION' | cmTranslate}}</label>
        <div class="checkbox-of-label">
            <button ng-click="toggleConversationEncryption()" data-qa="btn-encryption">
                <i class="fa cm-lg-icon cm-ci-color ml15" ng-class="{'cm-checkbox':!conversation.isEncrypted(), 'cm-checkbox-right':conversation.isEncrypted(), 'cm-grey':!isNew()}" data-qa="icon-checkbox-encryption"></i>
            </button>
        </div>
    </div>

    <div class="label-with-checkbox" ng-if="conversation.passwordRequired()">
        <label>{{'CONVERSATION.PLACEHOLDER.PASSCAPTCHA' | cmTranslate}}</label>
        <div class="checkbox-of-label">
            <button ng-click="toggleCaptcha()" data-qa="btn-toggle-captcha">
                <i class="fa cm-lg-icon cm-ci-color ml15" ng-class="{'cm-checkbox':!conversation.options.hasCaptcha, 'cm-checkbox-right':conversation.options.hasCaptcha, 'cm-grey':!isNew()}" data-qa="icon-checkbox-passcaptcha"></i>
            </button>
        </div>
    </div>

    <div ng-if="(conversation.passwordRequired() && conversation.isEncrypted()) || conversation.hasPassword()" id="password-area">
        <div class="captcha" ng-if="conversation.options.hasCaptcha && isNew()" data-qa="captcha-canvas">
            <cm-captcha></cm-captcha>
            <button class="refresh" ng-click="refreshCaptcha()" ng-if="isNew()"><i class="fa cm-change"></i></button>
            <p ng-if="!isNew()">
                <button ng-click="requestCaptcha()"><i class="fa cm-key"></i> {{"CONVERSATION.LABEL.REQUEST_CAPTCHA"|cmTranslate}}</button>
            </p>
            <p ng-if="!isNew()">
                <button ng-click="sendCaptcha()"><i class="fa cm-send"></i> {{"CONVERSATION.LABEL.SEND_CAPTCHA"|cmTranslate}}</button>
            </p>
        </div>

        <div class="captcha" ng-if="!isNew()" data-qa="captcha-image">
            <img cm-blob-image="conversation.passCaptcha" />
        </div>

        <div class="cm-form-group label-with-input">
            <label>{{'CONVERSATION.PLACEHOLDER.PASSWORD'|cmTranslate}}</label>
            <div class="cm-form-control with-inputter" style="background-color:#fff" ng-class="{'with-inside-icon':!isNew()}">
                <input
                    data-qa     ="input-password"
                    style       = "background-color:#fff" 
                    type        = "text" 
                    ng-model    ="conversation.password" 
                    placeholder ="{{'CONVERSATION.PLACEHOLDER.PASSWORD'|cmTranslate}}"
                    ng-blur     = "decrypt()"
                    ng-disabled = "conversation.state.is('decrypted')"
                />
                <i class="fa cm-checker" ng-if="conversation.state.is('decrypted')" data-qa="icon-conversation-decrypted"></i>
            </div>
        </div>
    </div>

    <div ng-if="conversation.options.showKeyInfo" class="settings-alert" cm-user-rights>
        <a href="#/settings/identity/keys" class="classic-link">
            {{'CONVERSATION.LABEL.KEY_GENERATION'|cmTranslate}}
        </a>
    </div>
    <div ng-if="showPasswordLocalKeyInfo && isNew()" class="settings-alert cm-orange" cm-user-rights>
        <i class="fa cm-attention"></i>
        {{'CONVERSATION.LABEL.SHOW_PW_INFO_BECAUSE_USER_HAS_NO_LOCAL_KEYS'|cmTranslate}}
    </div>
</section>

<cm-footer cm-always-on-top>
    <button ng-click="goBack()" class="cm-btn-block cm-btn-grey" data-qa="btn-security-done">
        {{'CONVERSATION.SETTINGS.OKAY'|cmTranslate}}
    </button>
</cm-footer>