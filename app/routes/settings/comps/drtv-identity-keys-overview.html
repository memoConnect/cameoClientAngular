<cm-header cm-rubber-space>
    <cm-back cm-weight="1" back-to="/settings"></cm-back>
    <cm-identity cm-weight="6"></cm-identity>
    <cm-menu cm-weight="1"></cm-menu>
</cm-header>

<header class="inScreen">
    <i class="fa cm-key cm-lg-icon"></i> {{'SETTINGS.PAGES.IDENTITY.KEYS.HEADER'|cmTranslate}}
</header>

<ul>
    <li ng-if="showKeyTrustDescription">
        <div class="page" data-qa="alert-key-needed">
            {{'SETTINGS.PAGES.IDENTITY.KEYS.KEY_TRUST_DESCRIPTION'|cmTranslate}}
        </div>
    </li>
    <li ng-repeat="key in publicKeys | orderBy:sortByPrivKeys" data-qa="key-list-item">
        <a href="#/settings/identity/key/{{key.id}}" class="item tal clearfix">
            <strong>{{key.name}}</strong>
            <span class="second-row">
                {{privateKeys.find(key).getSize() || key.getSize() || key.size}}
                <span class="seperator">|</span>
                <strong ng-if="privateKeys.find(key)" data-qa="key-is-local" class="is-local">{{'SETTINGS.PAGES.IDENTITY.KEYS.IS_LOCAL'|cmTranslate}}
                    <span class="seperator">|</span>
                </strong>
                <span ng-if="isTrustedKey(key)" class="is-trusted">{{'SETTINGS.PAGES.IDENTITY.KEYS.IS_TRUSTED'|cmTranslate}}
                    <span class="seperator">|</span>
                </span>
                <span ng-if="!isTrustedKey(key)" class="is-untrusted">{{'SETTINGS.PAGES.IDENTITY.KEYS.IS_UNTRUSTED'|cmTranslate}}
                    <span class="seperator">|</span>
                </span>
                {{key.created | date:'dd.MM.yy - HH:mm'}}
            </span>
        </a>
        <div class="short-links">
            <i class="fa cm-handshake cm-lg-icon" ng-if="!isTrustedKey(key) && isHandshakePossible" ng-click="startAuthentication(key)"></i>
            <i class="fa cm-export-key cm-lg-special" ng-if="privateKeys.find(key)" ng-click="openModal('modalExportKeyPair',key)"></i>
            <i class="fa cm-checkbox-wrong cm-lg-icon" ng-click="openModal('modalRemoveKeypair',key)" data-qa="btn-remove-modal"></i>
        </div>
    </li>
    <li ng-if="signing">
        <cm-spinner></cm-spinner>
    </li>
</ul>

<cm-modal id="modalExportKeyPair" class="no-padding" cm-data-as="key" cm-title="SETTINGS.PAGES.IDENTITY.KEYS.EXPORT_KEY">
    <div class="modal-row">
        <h3>{{key.name}}</h3>
        <span ng-if="privateKeys.find(key)">{{'SETTINGS.PAGES.IDENTITY.KEYS.EXPORT_KEY_DESCRIPTION'|cmTranslate}}</span>
        <h4 ng-if="privateKeys.find(key)" class="is-local">{{'SETTINGS.PAGES.IDENTITY.KEYS.IS_LOCAL_ON_THIS_DEVICE'|cmTranslate}}</h4>
        <h4>
            <strong>{{'SETTINGS.PAGES.IDENTITY.KEYS.TRUSTING'|cmTranslate}}:</strong>
            <span ng-if="isTrustedKey(key)" class="is-trusted">
                {{'SETTINGS.PAGES.IDENTITY.KEYS.IS_TRUSTED'|cmTranslate}}
            </span>
            <span ng-if="!isTrustedKey(key)" class="is-untrusted">
                {{'SETTINGS.PAGES.IDENTITY.KEYS.IS_UNTRUSTED'|cmTranslate}}
            </span>
        </h4>
        <h4>
            <strong>{{'SETTINGS.PAGES.IDENTITY.KEYS.KEY_SIZE'|cmTranslate}}:</strong>
            {{privateKeys.find(key).getSize() || key.getSize() || key.size}}
        </h4>
        <span>{{'SETTINGS.PAGES.IDENTITY.KEYS.EXPORT_KEY_DESCRIPTION'|cmTranslate}}</span>
            <h3>{{'SETTINGS.PAGES.IDENTITY.KEYS.PRIVATE_KEY'|cmTranslate}}</h3>
            <textarea class="form-control" cm-clipboard readonly>{{privateKeys.find(key).getPrivateKey()}}</textarea>
        </div>
    </div>
</cm-modal>

<cm-modal id="modalRemoveKeypair" class="no-padding" cm-data-as="key" cm-title="SETTINGS.PAGES.IDENTITY.KEYS.REMOVE_KEY">
    <div class="modal-row">
        <h3>{{key.name}} - {{key.getSize()}} - {{key.created | date:'dd.MM.yy - HH:mm'}}</h3>
    </div>
    <button class="cm-btn-block cm-btn-grey" ng-click="remove(key)" data-qa="btn-remove-key">
        {{'SETTINGS.PAGES.IDENTITY.KEYS.REMOVE_KEY_REALLY'|cmTranslate}}
        <i class="fa cm-checker cm-lg-icon"></i>
    </button>
</cm-modal>

<cm-footer ng-if="canCreate">
    <a href="#/settings/identity/keys/create"
        class="item w50 no-pad cm-btn-grey"
        data-qa="btn-create-key">
        <i class="fa cm-create-key icon-left cm-lg-special"></i>
        <span>{{'SETTINGS.PAGES.IDENTITY.KEYS.CREATE.BUTTON'|cmTranslate}}</span>
    </a>
    <a href="#/settings/identity/keys/import"
        class="item w50 no-pad cm-btn-grey"
        data-qa="btn-import-key">
        <i class="fa cm-import-key icon-left cm-lg-special"></i>
        <span>{{'SETTINGS.PAGES.IDENTITY.KEYS.IMPORT.BUTTON'|cmTranslate}}</span>
    </a>
</cm-footer>
