
<section ng-controller="AuthenticationCtrl">
    <cm-header cm-rubber-space>
        <cm-back cm-weight="1" back-to="/settings"></cm-back>
        <cm-identity cm-weight="6"></cm-identity>
        <cm-menu cm-weight="1"></cm-menu>
    </cm-header>

    <section class = "theme-a">

            <h2>
                <i class = "fa cm-key"></i>
                {{
                [
                BASE+"PAGE_HEADLINE",
                BASE+"PAGE_HEADLINE",
                BASE+"PAGE_HEADLINE",
                BASE+"PAGE_HEADLINE"
                ][step]

                | cmTranslate}}
            </h2>


            <article>
                <div class= "authentication-status" ng-click = "step = ((step||0)+1)%4">
                    <i class= "fa cm-key-request"   ng-class="{'active': step > 0}"></i>
                    <i class= "fa cm-key-response"  ng-class="{'active': step > 1}"></i>
                    <i class= "fa cm-handshake"     ng-class="{'active': step > 3}"></i>
                </div>
                <div class= "space-for-loader">
                    <cm-loader cm-halt = "waiting" type="balls"></cm-loader>
                </div>
            <article>

            <hr/>

            <h3>
                {{ 
                    [
                        BASE+"HEADLINE",
                        BASE+"HEADLINE", 
                        BASE+"HEADLINE", 
                        BASE+"HEADLINE" 
                    ][step]

                | cmTranslate}}
            </h3>

            <article>
                <cm-info-bubble nose-x = "60%">
                    {{
                        [
                            BASE+"EXPLANATION",
                            BASE+"EXPLANATION",
                            BASE+"EXPLANATION",
                            BASE+"EXPLANATION"
                        ][step]

                    | cmTranslate:{'identity': toIdentity.getDisplayName()} }}

                    <br/>
                    <br/>

                    <strong>
                        {{
                            [
                                BASE+"START.INSTRUCTIONS",
                                BASE+"REQUEST_STARTED.INSTRUCTIONS",
                                BASE+"SHOW_TRANSACTION_SECRET.INSTRUCTIONS",
                                BASE+"SHOW_TRANSACTION_SECRET.INSTRUCTIONS"
                            ] [step]

                        | cmTranslate }}
                    </strong>
                </cm-info-bubble>
            </article>

            <hr/>

            <article>
                <strong>
                    {{
                        [
                            BASE+"START.NOTE",
                            BASE+"REQUEST_STARTED.NOTE",
                            BASE+"SHOW_TRANSACTION_SECRET.NOTE",
                            BASE+"SHOW_TRANSACTION_SECRET.NOTE"
                        ][step] 

                    | cmTranslate:{'identity': toIdentity.getDisplayName()} }}
                </strong>
            </article>

            <article ng-if = "step > 1">
                <div class="transaction-secret">
                    {{transactionSecret || '...'}}
                </div>
            </article>

            <br/>

            <article ng-if ="timeout">
                {{BASE+"TIMEOUT" | cmTranslate: {'timeout' : timeout/1000 +'s'} }}
            </article>


    </section>


    <cm-footer ng-if = "step == 0" cm-rubber-space>
        <button 
            ng-click    = "cancel()" 
            class       = "cm-btn-block cm-btn-grey" 
            data-qa     = "btn-start-authentication"
            cm-weight   = "1"
        >
            {{BASE+"START.CANCEL_BUTTON"|cmTranslate}}
            <i class="fa cm-checkbox-wrong cm-lg-icon"></i>
        </button>
        
        <button 
            ng-click    = "requestKey()" 
            class       = "cm-btn-block cm-btn-grey" 
            data-qa     = "btn-start-authentication"
            cm-weight   = "1"
        >
            {{BASE+"START.START_BUTTON"|cmTranslate}}
            <i class="fa cm-handshake cm-lg-icon"></i>
        </button>

    </cm-footer>

    <cm-footer ng-if = "step == 1" cm-rubber-space>

        <button 
            ng-click    = "cancel()" 
            class       = "cm-btn-block cm-btn-grey" 
            data-qa     = "btn-start-authentication"
        >
            {{BASE+"REQUEST_STARTED.CANCEL_BUTTON"|cmTranslate}}
            <i class="fa cm-checkbox-wrong cm-lg-icon"></i>
        </button>

    </cm-footer>

    <cm-footer ng-if = "step == 3" cm-rubber-space>

        <button 
            ng-click    = "cancel()" 
            class       = "cm-btn-block cm-btn-grey" 
            data-qa     = "btn-start-authentication"
        >
            {{BASE+"SHOW_TRANSACTION_SECRET.CLOSE_BUTTON"|cmTranslate}}
            <i class="fa cm-checkbox-wrong cm-lg-icon"></i>
        </button>

    </cm-footer>

    <cm-footer ng-if = "step == 4" cm-rubber-space>
 
        <button 
            ng-click    = "startAuthenticationRequest()" 
            class       = "cm-btn-block cm-btn-grey" 
            data-qa     = "btn-start-authentication"
        >
            {{BASE+"AUTHENTICATION.START"|cmTranslate}}
            <i class="fa cm-handshake cm-lg-icon"></i>
        </button>
        
    </cm-footer>

</section>