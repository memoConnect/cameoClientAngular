<cm-conversation-controls></cm-conversation-controls>

<div id="conversation-top"></div>

<div ng-repeat="message in conversation.messages | orderBy:'created':true " cm-scroll-to="#conversation-bottom" cm-last-message>
    <cm-date-seperator ng-if="(compareDate(message.created,conversation.messages[$index - 1].created))">{{message.created | date:'dd.MM.yyyy'}}</cm-date-seperator>
    <cm-message cm-data="message" cm-data-conversation="conversation"></cm-message>
</div>

<div id="conversation-bottom"></div>

<div class="answer clearfix" id="files-droparea">
    <cm-files ng-model="files" data-qa="attachments-btn">
        <i class="fa cm-attachment"></i>
        <div cm-user-rights>
            <cm-file-choose cm-droparea="files-droparea"></cm-file-choose>
            <cm-files-preview></cm-files-preview>
        </div>
        <div class="webreader-uploading" cm-user-rights="showForGuest" ng-click="openFastRegister()" data-qa="btn-fast-registration"></div>
    </cm-files>

    <div class="message" data-qa="answer-ctn">
        <textarea data-qa="input-answer" cm-resize-textarea cm-max-rows="4" ng-model="my_message_text" id="emoji-textarea" cm-ios-focus="{fixedElements:'cm-header, cm-conversation-controls',handler:'.post-wrap'}"></textarea>
        <cm-emoji-handler></cm-emoji-handler>
        <div class="inputter"></div>
    </div>

    <cm-emoji-list ng-model="my_message_text" cm-textarea="emoji-textarea"></cm-emoji-list>

    <div class="post-wrap" data-qa="btn-send-answer" ng-click="send()">
        <i class="fa cm-post with-cursor {{conversation.lockStatus.class}}-wrap" ng-class="{'cm-post-idle':isSending, 'cm-post-attention':isSendingAbort}"></i>
    </div>
</div>