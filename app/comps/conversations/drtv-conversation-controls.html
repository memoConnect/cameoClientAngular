 <div class="control">
    <div cm-transparent-bg ng-show="bodyVisible" ng-click="toggleControls()"></div>
    <div ng-show="bodyVisible" class="body" data-qa="conversation-options-menu">

        <div class="cm-form-group" ng-show="isNew">
            <div class="cm-form-control with-inputter">
                <input type="text" ng-model="conversation.subject" placeholder="{{'CONVERSATION.PLACEHOLDER.NO_SUBJECT'|cmTranslate}}" cm-adaptive-change data-qa="input-subject"/>
            </div>
        </div>

        <div class="body-group" ng-click="show_aspects = !show_aspects">
            <cm-security-indicator cm-data="conversation.securityAspects"/>
        </div>

        <div class="body-group" ng-if="show_aspects">
            <cm-security-aspect ng-repeat="aspect in conversation.securityAspects.getNegativeAspects()" cm-data="aspect"></cm-security-aspect>
            <cm-security-aspect ng-repeat="aspect in conversation.securityAspects.getPositiveAspects()" cm-data="aspect"></cm-security-aspect>
        </div>

        <div class="body-group">
            <div class="recipients-list">
                <cm-avatar cm-data="recipient" cm-with-name="true" cm-view="hide-owner" ng-repeat="recipient in conversation.recipients"></cm-avatar>

                <div ng-click="manageRecipients()" ng-if="conversation.recipients.length == 1" class="add-new-recipients" cm-user-rights>
                    <cm-avatar cm-view="unknown"></cm-avatar>
                    {{'CONVERSATION.PLACEHOLDER.ADD_RECIPIENTS'|cmTranslate}}
                    <cm-edge></cm-edge>
                </div>

                <div ng-click="manageRecipients()" ng-if="conversation.recipients.length > 1" class="add-recipients" cm-user-rights>
                    <cm-edge></cm-edge>
                </div>
            </div>
        </div>

        <div class="body-group">
            <div>
                <label>{{'CONVERSATION.PLACEHOLDER.ENCRYPTION' | cmTranslate}}</label>
                <button ng-click="toggleConversationEncryption()"><i class="fa cm-lg-icon cm-ci-color ml15" ng-class="{'cm-checkbox':!isEncrypted, 'cm-checkbox-right':isEncrypted}" data-qa="icon-checkbox-encryption"></i></button>
            </div>

            <div ng-if="showPassword">
                <label>{{'CONVERSATION.PLACEHOLDER.PASSCAPTCHA' | cmTranslate}}</label>
                <button ng-click="toggleCaptcha()"><i class="fa cm-lg-icon cm-ci-color ml15" ng-class="{'cm-checkbox':!hasCaptcha, 'cm-checkbox-right':hasCaptcha}" data-qa="icon-checkbox-passcaptcha"></i></button>
            </div>

            <div ng-if="showPassword">
                <div class="captcha" ng-if="hasCaptcha && isNew" data-qa="captcha-canvas">
                    <cm-captcha></cm-captcha>
                    <button class="refresh" ng-click="refreshCaptcha()" ng-if="isNew"><i class="fa cm-change"></i></button>
                    <p ng-if="!isNew">
                        <button ng-click="requestCaptcha()"><i class="fa cm-key"></i> {{"CONVERSATION.LABEL.REQUEST_CAPTCHA" | cmTranslate}}</button>
                    </p>
                    <p ng-if="!isNew">
                        <button ng-click="sendCaptcha()"><i class="fa cm-send"></i> {{"CONVERSATION.LABEL.SEND_CAPTCHA" | cmTranslate}}</button>
                    </p>
                </div>

                <div class="cm-form-group">
                    <div class="cm-form-control with-inputter" ng-class="{'with-inside-icon':!isNew}">
                        <input type="text" ng-model="conversation.password" placeholder="{{'CONVERSATION.PLACEHOLDER.PASSWORD'|cmTranslate}}" cm-adaptive-change/>
                        <i class="fa cm-key fa-2x with-cursor" ng-click="decrypt()" ng-if="!isNew"></i>
                    </div>
                </div>

				<div class="captcha" ng-if="!isNew" data-qa="captcha-image">
                    <img cm-blob-image="conversation.passCaptcha" />
                </div>

            </div>

            <div class="cm-center">
                <i class="fa cm-info"></i>
                {{'CONVERSATION.PLACEHOLDER.INFO'|cmTranslate}}
            </div>

            <div style="text-align:center; cursor:pointer" cm-user-rights>
                <a href="#/settings">
                    {{'CONVERSATION.LABEL.KEY_GENERATION'|cmTranslate}}
                </a>
            </div>
        </div>

        <button ng-click="toggleControls()" class="cm-btn" ng-if="!isNew" data-qa="btn-save-options">{{'CONVERSATION.CONTROL.CLOSE'|cmTranslate}} <i class="fa cm-close cm-lg-icon"></i></button>
        <button ng-click="toggleControls()" class="cm-btn" ng-if="isNew" data-qa="btn-save-options">{{'CONVERSATION.CONTROL.SAVE'|cmTranslate}} <i class="fa cm-checker cm-lg-icon"></i></button>
    </div>

    <div class="cm-bar" cm-rubber-space ng-click="toggleControls()" data-qa="conversation-options-bar">
        <div cm-weight="1" class="grip-left">
            <i class="fa cm-grip"></i>
        </div>
        <div cm-weight="8" class="cm-bar-infos">
            <span ng-bind-html="conversation.subject||'CONVERSATION.PLACEHOLDER.NO_SUBJECT'|cmParse"></span>
            <cm-safety-level cm-level="conversation.getSafetyLevel()"></cm-safety-level>
            <cm-recipient-counter>{{conversation.recipients.length||0}}</cm-recipient-counter>
        </div>
        <div cm-weight="1"></div>
    </div>
</div>