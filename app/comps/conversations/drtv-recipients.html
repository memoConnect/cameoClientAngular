<ul>
    <li ng-repeat   = "contact in contacts|cmRecipients:true:selected|cmSearch:'contacts':search"
        ng-if       = "contact.contactType != 'pending'" 
    >
        <cm-contact-tag cm-rubber-space>
            <cm-avatar cm-data="contact.identity"></cm-avatar>
            <cm-key-level cm-data="contact.identity.keys.getWeakestKeySize()"></cm-key-level>
            <cm-contact-brief cm-data="contact" cm-weight="1"></cm-contact-brief>
            <cm-contact-type cm-data="contact"></cm-contact-type>
            <button
                data-qa="btn-select-contact"
                ng-click="toggleRecipient(contact.identity)"
                ng-disabled="!conversation.state.is('new')">
                <i class="fa"
                    ng-class="{
                        'cm-checkbox':!selected[contact.identity.id],
                        'cm-checkbox-right':selected[contact.identity.id]
                    }"></i>
            </button>
        </cm-contact-tag>
    </li>
</ul>

<hr>

<ul ng-if="conversation.state.is('new')">
    <li
        ng-repeat   =   "contact in contacts|cmRecipients:false:selected|cmSearch:'contacts':search"
        ng-if       =   "contact.contactType != 'pending'"
    >
        <cm-contact-tag cm-rubber-space>
            <cm-avatar cm-data="contact.identity"></cm-avatar>
            <cm-key-level cm-data="contact.identity.keys.getWeakestKeySize()"></cm-key-level>
            <cm-contact-brief cm-data="contact" cm-weight="1"></cm-contact-brief>
            <cm-contact-type cm-data="contact"></cm-contact-type>
            <button
                data-qa="btn-select-contact"
                ng-click="toggleRecipient(contact.identity)"
                ng-disabled="contact.contactType == 'pending' || !conversation.state.is('new')">
                <i
                    class="fa"
                    ng-class="{
                        'cm-checkbox':!selected[contact.identity.id],
                        'cm-checkbox-right':selected[contact.identity.id]
                    }"></i>
            </button>
        </cm-contact-tag>
    </li>
</ul>

<cm-footer cm-always-on-top>
    <button ng-click="goBack()" class="cm-btn-block cm-btn-grey" data-qa="btn-done" cm-weight="1">
        {{'RECIPIENTS.LABEL.DONE'|cmTranslate}}
    </button>
</cm-footer>